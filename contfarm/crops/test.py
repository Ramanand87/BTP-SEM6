import sys
import cv2
from pyzbar.pyzbar import decode
from pyaadhaar.decode import AadhaarSecureQr

# Increase the maximum number of digits for integer string conversion
sys.set_int_max_str_digits(10000)  # Adjust the limit as needed

def extract_aadhaar_data(image_path):
    # Read the image
    image = cv2.imread(image_path)

    # Decode QR codes using pyzbar
    qr_codes = decode(image)
    
    for qr in qr_codes:
        try:
            # Convert QR code data from bytes to an integer
            qr_data_int = int.from_bytes(qr.data, byteorder='big')

            # Convert the integer to a base10-encoded string
            qr_data_str = qr_data_int
            # Decode the QR code data
            aadhaar_qr = AadhaarSecureQr("41242104357208387792987520802729440853055237495535391100113436106936520095344856605605344753686159489610770063660255992226717974604387128542185110899161678510632346849976288233772559299169181926202149935351732124756153293870197083710000118195112006272474668909531799214639986029590930036760467638746454639103786674559910967139131837194522870056648760105187551972206160265166133313269479248446459588693185909692796661225374706057491426582404476230203248745353397558232719001805997848024087730824179967963817893220040714544167459302730742572999757741748426200415998804722511867516736509536179055922794412774902179352669975512858681232467280288841918574598510790283322366348353639484071414241776155563166177407502260863044762320470931481327196970120544059968373179387491523892637536831935950050377511497580575614198097307773466462366077463661556328102504248092250049383945212892049739996247680917056149952931103216392562334326796376288783251845364381188512264209479145895772588365961039195569428204426335475471934188661954612812981583756879659009397276721088343065909923322361086345298138927916583451878624764994676152471069222119565448070599012160257029043437819606657160332488173552843057672834127248585577342241435320779663752821214473776807628051672215507939078535754189652108074055635675995669297374359675111492435746459716189712460291205215973020853835270928086218582150545301320448009477751805610693449242825424182801394998417085371419790597652487827655024809308400346953653129082871622673553408915502701525780283927479817860845234802628078889529687812022251023068826587892158018178085712743660994030378636039476592660508474121597479339053836780698645798564808937828462435287445398729832109225666192030306623103589486850037397003313609745909599024421249332307061752821783131348283298758904423156943025445868718024846717640249599550637183463496778050511746839870722054934586351077966649152881882008506033695932414950154085766791592273059536125976082372822626916197564661396343464713210524940605654559389303360172801323804950158452737274414210560932780168544494507655183005119758145088012313112881711842288681783842525860773327496595561424891038157992033300860527812278167960440150500001532611481459990513543496176711032927422181612585907980535896906850849341456588364240986644196193517023612041366307334666243634053097603996060922238671237200211468504226158454841805985795235028157623685729213089152916974194129141595667491505230424198740456802647508020052873779463609768539318950062717109511682622296276897068633573503467549613074129614750591945049626780483658821094743690798868976400590262613103381642641073728120444997249528506569582008171984787480839233985549974680654738582154405071921610094854380226416874607732270629214696617883756022205466473581318950425222800221952287250368933904990176189026502480804186015715963321415525136278863347723655099201008522593408113539401039633136266015416562521674649512382234671368458393740867288869714064615921189052438598573282690839821795721331001381964097278692812980224")
            return aadhaar_qr.decodeddata
        except Exception as e:
            return {"error": f"Decoding failed: {str(e)}"}

    return {"error": "QR code not detected in the image."}

# Example usage
image_path = "C:/Users/ASUS/Downloads/DID.png"
result = extract_aadhaar_data(image_path)
print(result)
